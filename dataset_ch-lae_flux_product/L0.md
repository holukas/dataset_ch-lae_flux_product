# Level-0: Preliminary flux calculations

`````{admonition} Info
:class: note
Results from preliminary flux calculations with relaxed processing settings assist in finding the most appropriate settings for final flux calculations (Level-1).
`````

Level-0 flux results help to find the best settings for the final flux calculations. Generally, these preliminary results are used:
- to check whether the flux processing works,
- to check the wind direction across years,
- to determine appropriate time windows for lag search for final flux calculations.

More details can be found in the documentation of the [Flux Processing Chain](https://www.swissfluxnet.ethz.ch/index.php/data/ecosystem-fluxes/flux-processing-chain/#Step_2_Level-0_Preliminary_Flux_Calculations_With_OPENLAG_and_Other_Tests)

## OPENLAG runs to determine final lag ranges

`````{admonition} Notebook
:class: tip
[02_L0_timelags_check](https://holukas.github.io/dataset_ch-cha_flux_product/notebooks/00_L0_checks/02_L0_timelags_check.html)
`````

The lag between turbulent departures of wind and the gas of interest was first determined in a relatively wide time window (called OPENLAG).
### IRGA72 (2016-2024)

- **IRGA** OPENLAG time window: between `-1s` and `+10s`. For IRGA, the goal was to find an appropriate nominal time lag, and to determine a time window for lag search as narrow as possible.
- The value `-1s` was used as the starting value for the time window because EddyPro had issues with a start value of `0s`, in that case the lag search started e.g. at +1s for some reason (maybe bug)
- The results from the OPENLAG runs were used to define a time window as narrow as possible (IRGA) for the final flux calculations (Level-1)
- The histograms of found OPENLAG time lags were inspected to determine whether there was a the histogram bin with peak distribution
- **IRGA**: peak of distribution was used as nominal (default) lag, time ranges around this peak were used as time window ([table](table-irga-openlags))

| **time period**    | **CO2 IRGA**    | **H2O IRGA** | **Notes** |
| ------------------ | --------------- | ------------ | --------- |
| **2016_X**         | 0.35, 0.05-0.55 |              |           |
| **2017_X**         |                 |              |           |
| **2018_1+2+3+4**   |                 |              |           |
| **2019_1+2+3+4+5** |                 |              |           |
| **2020_1+2+3+4+5** |                 |              |           |
| **2021_1+2**       | 8.40,           | 8.55,        |           |
| **2022_1+2+3**     |                 |              |           |
| **2023_1**         |                 |              |           |
| **2024_1**         |                 |              |           |





---
(table-irga-openlags)=
```{table} IRGA nominal (default) time lags and size of the lag search windows for different time periods in seconds. Used for CO2 and H2O (LE) in final flux calculations.

| **time period**    | **CO2 IRGA**    | **H2O IRGA** | **Notes**             |
| ------------------ | --------------- | ------------ | --------------------- |
| **2005_X**         | 0.20, 0.05-0.40 | same as CO2  |                       |
| **2006_X**         | 0.25, 0.05-0.40 | same as CO2  |                       |
| **2007_X**         | 0.25, 0.05-0.40 | same as CO2  |                       |
| **2008_X**         | 0.25, 0.05-0.40 | same as CO2  |                       |
| **2009_X**         | 0.25, 0.05-0.40 | same as CO2  |                       |
| **2010_X**         | 0.30, 0.05-0.50 | same as CO2  |                       |
| **2011_X**         | 0.30, 0.05-0.55 | same as CO2  |                       |
| **2012_X**         | 0.35, 0.05-0.55 | same as CO2  | first time period QCL |
| **2013_X**         | 0.30, 0.05-0.55 | same as CO2  |                       |
| **2014_X**         | 0.30, 0.05-0.55 | same as CO2  |                       |
| **2015_X**         | 0.30, 0.05-0.55 | same as CO2  |                       |
| **2016_X**         | 0.35, 0.05-0.55 | same as CO2  |                       |
| **2017_X**         | 0.30, 0.05-0.55 | same as CO2  |                       |
| **2018_1+2+3+4**   | 0.25, 0.05-0.50 | same as CO2  |                       |
| **2019_1+2+3+4+5** | 0.30, 0.05-0.45 | same as CO2  |                       |
| **2020_1+2+3+4+5** | 0.30, 0.05-0.45 | same as CO2  |                       |
| **2021_1+2**       | 0.25, 0.05-0.45 | same as CO2  |                       |
| **2022_1+2+3**     | 0.25, 0.05-0.45 | same as CO2  |                       |
| **2023_1**         | 0.30, 0.05-0.50 | same as CO2  |                       |
| **2024_1**         | 0.30, 0.05-0.50 | same as CO2  |                       |
```



---
## Check wind direction across years

`````{admonition} Notebook
:class: tip
[03_L0_winddir_check](https://holukas.github.io/dataset_ch-cha_flux_product/notebooks/00_L0_checks/03_L0_winddir_check.html)
`````

I compared histograms of wind directions between 2005 and 2024 using Level-0 fluxes and found that a sonic orientation of 7° offset to north yields very similar results across years. It is therefore possible the the sonic orientation across all years was always close to 7°.

Here are results from a comparison of annual wind direction histograms (with bin width of 1°) to a reference period (2006-2009), all wind directions were calculated with a north offset of 7°, then a histogram was calculated for each year. The OFFSET describes how many degrees have to be added (or subtracted) to the half-hourly wind direction to yield a histogram that is most similar to the reference. All OFFSETS are small, which indicates that the wind directions are in good agreement ([table](table-winddir)).

(table-winddir)=
```{table} Wind direction offsets (in degrees) compared to a reference period (2006-2009) from Level-0 OPENLAG runs.

| **YEAR** | **OFFSET (°)** |
| -------- | -------------------- |
| **2005** | 1.0                  |
| **2006** | 0.0                  |
| **2007** | -2.0                 |
| **2008** | -2.0                 |
| **2009** | 0.0                  |
| **2010** | 2.0                  |
| **2011** | 6.0                  |
| **2012** | 1.0                  |
| **2013** | 1.0                  |
| **2014** | 1.0                  |
| **2015** | 1.0                  |
| **2016** | 3.0                  |
| **2017** | 4.0                  |
| **2018** | 1.0                  |
| **2019** | -1.0                 |
| **2020** | -1.0                 |
| **2021** | -1.0                 |
| **2022** | 1.0                  |
| **2023** | -2.0                 |
| **2024** | 1.0                  |
```


